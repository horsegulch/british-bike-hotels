{% extends "base.html" %}

{% block title %}{{ user.username }}'s Profile{% endblock %}

{% block content %}
<div class="container page-content-container">
    <div class="profile-header">
        <img src="{{ avatar_url }}" alt="User Avatar">
        <div class="profile-header-info">
           <h1>{{ user.username }}</h1>
           <p>{{ user.email }}</p>
            {% if user.location %}
                <p><strong>Location:</strong> {{ user.location }}</p>
            {% endif %}
            {% if user.bio %}
                <p><em>{{ user.bio }}</em></p>
            {% endif %}
            <p><a href="{{ url_for('routes.edit_profile') }}" style="font-size: 0.9em;">Edit Profile</a></p>
        </div>
    </div>

    <div class="tabs">
        <button class="tab-link active" data-tab="uploads">My Uploads</button>
        <button class="tab-link" data-tab="liked">Liked Routes</button>
        <button class="tab-link" data-tab="reviews">My Reviews</button>
        <button class="tab-link" data-tab="feed">Feed</button>
        <button class="tab-link" data-tab="photos">Photos</button>
    </div>

    <div id="uploads" class="tab-content active">
        <div id="compareContainerProfile" style="display: flex; justify-content: flex-start; align-items: center; gap: 15px; margin: 20px 0;">
            <button id="compareBtnProfile" class="hero-cta-button">Compare Selected</button>
            <button id="clearSelectionBtnProfile" class="download-button" style="background-color: #A5AF9B;">Clear Selection</button>
        </div>
        {% if uploaded_routes %}
            <div id="uploadedRoutesList" class="route-list">
                {% for route in uploaded_routes %}
                    <div class="route-card">
                        <input type="checkbox" class="route-checkbox-profile" data-route-id="{{ route._id }}" style="position: absolute; top: 15px; left: 15px; z-index: 2; width: 20px; height: 20px;">
                        <a href="{{ url_for('routes.route_profile_page', route_id=route._id) }}" class="route-card-thumbnail-link">
                            <div class="route-card-map-thumbnail">
                                <img src="{{ route.static_map_thumbnail_url }}" alt="Map for {{ route.route_name or 'Unnamed Route' }}">
                            </div>
                        </a>
                        <div class="route-card-content">
                            <h3><a href="{{ url_for('routes.route_profile_page', route_id=route._id) }}">{{ route.route_name or 'Unnamed Route' }}</a></h3>
                            <div class="route-card-stats">
                                <span><strong>Distance:</strong> {{ route.metrics_summary.distance_km|round(1) }} km</span>
                                <span><strong>Elevation:</strong> {{ route.metrics_summary.TEGa|round }} m</span>
                            </div>
                            <div class="route-card-creator-info">
                                {% if route.creator_avatar_url %}
                                    <img src="{{ route.creator_avatar_url }}" alt="{{ route.creator_username or 'Anonymous' }}'s avatar" class="creator-avatar-thumbnail">
                                {% endif %}
                                <span class="creator-username">By: {{ route.creator_username or 'Anonymous' }}</span>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p>You haven't uploaded any routes yet.</p>
        {% endif %}
    </div>

    <div id="liked" class="tab-content">
        {% if liked_routes %}
            <div id="likedRoutesList" class="route-list">
                {% for route in liked_routes %}
                    <div class="route-card">
                        <input type="checkbox" class="route-checkbox-profile" data-route-id="{{ route._id }}" style="position: absolute; top: 15px; left: 15px; z-index: 2; width: 20px; height: 20px;">
                        <a href="{{ url_for('routes.route_profile_page', route_id=route._id) }}" class="route-card-thumbnail-link">
                            <div class="route-card-map-thumbnail">
                                <img src="{{ route.static_map_thumbnail_url }}" alt="Map for {{ route.route_name or 'Unnamed Route' }}">
                            </div>
                        </a>
                        <div class="route-card-content">
                            <h3><a href="{{ url_for('routes.route_profile_page', route_id=route._id) }}">{{ route.route_name or 'Unnamed Route' }}</a></h3>
                            <div class="route-card-stats">
                                <span><strong>Distance:</strong> {{ route.metrics_summary.distance_km|round(1) }} km</span>
                                <span><strong>Elevation:</strong> {{ route.metrics_summary.TEGa|round }} m</span>
                            </div>
                            <div class="route-card-creator-info">
                                {% if route.creator_avatar_url %}
                                    <img src="{{ route.creator_avatar_url }}" alt="{{ route.creator_username or 'Anonymous' }}'s avatar" class="creator-avatar-thumbnail">
                                {% endif %}
                                <span class="creator-username">By: {{ route.creator_username or 'Anonymous' }}</span>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="mt-3">You haven't liked any routes yet.</p>
        {% endif %}
    </div>

    <div id="reviews" class="tab-content">
        {% if user_reviews %}
            <div class="trending-reviews-grid" style="margin-top: 20px;">
                {% for review in user_reviews %}
                <div class="trending-review-card">
                    <blockquote class="trending-review-body">
                        "{{ review.ride_report | truncate(200, True) }}"
                    </blockquote>
                    <div class="trending-review-meta">
                        <span>for <a href="{{ url_for('routes.route_profile_page', route_id=review.route_details._id) }}">{{ review.route_details.route_name }}</a></span>
                        <span class="vote-score-display">â˜… {{ (review.upvotes | length) - (review.downvotes | length) }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="mt-3">You haven't submitted any reviews yet.</p>
        {% endif %}
    </div>

    <div id="feed" class="tab-content">
        <p style="padding: 20px 0;">A future activity feed from users you follow will appear here.</p>
    </div>

    <div id="photos" class="tab-content">
        <p style="padding: 20px 0;">A future gallery of your uploaded route photos will appear here.</p>
    </div>

</div>

<div id="comparisonModal" class="modal-overlay hidden">
    </div>
{% endblock %}


{% block scripts %}
{{ super() }} <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/profile.js') }}"></script>
{% endblock %}